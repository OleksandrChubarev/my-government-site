<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Державні структури України</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    .content {
      margin-top: 20px;
    }
    .card {
      margin-bottom: 20px;
    }
    .comment-form {
      margin-top: 20px;
    }
    .comment-list {
      margin-top: 20px;
    }
    .comment {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }
    .legal-notice {
      font-size: 0.9em;
      color: #555;
      margin-top: 20px;
    }
    .error-message {
      color: red;
      margin-top: 10px;
    }
  </style>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Держструктури</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="showHome()">Головна</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="showCountry('ukraine')">Україна</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container content">
    <div id="content"></div>
  </div>

  <!-- Firebase SDK (UMD версія) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script>
    console.log('Початок ініціалізації Firebase');
    if (typeof firebase === 'undefined') {
      console.error('Firebase SDK не завантажено');
      document.getElementById('content').innerHTML += '<p class="error-message">Не вдалося завантажити Firebase. Перевірте підключення до Інтернету.</p>';
    } else {
      console.log('Firebase SDK завантажено');
    }

    const firebaseConfig = {
      apiKey: "AIzaSyBa7fBEThNMnOfmri5M9PG4qZ-fD5deRxw",
      authDomain: "my-government-site.firebaseapp.com",
      projectId: "my-government-site",
      storageBucket: "my-government-site.firebasestorage.app",
      messagingSenderId: "1020514447673",
      appId: "1:1020514447673:web:45501a56e45db6dd9038e8"
    };

    let db;
    try {
      firebase.initializeApp(firebaseConfig);
      db = firebase.firestore();
      console.log('Firestore ініціалізовано');
    } catch (error) {
      console.error('Помилка ініціалізації Firebase:', error);
      document.getElementById('content').innerHTML += '<p class="error-message">Не вдалося підключитися до бази даних: ' + error.message + '</p>';
    }

    const data = {
      countries: [
        {
          name: "Україна",
          id: "ukraine",
          ministries: [
            {
              name: "Міністерство внутрішніх справ",
              id: "mvs",
              description: "Відповідає за безпеку та правопорядок.",
              departments: [
                { name: "Департамент юридичного забезпечення", id: "mvs-legal" },
                { name: "Департамент інформатизації", id: "mvs-it" }
              ],
              enterprises: [
                { name: "ДП 'Укрспецзахист'", id: "ukrspeczahist" }
              ],
              officials: [
                { name: "Інна Ящук", position: "Державний секретар", id: "inna-yashchuk" },
                { name: "Богдан Драп’ятий", position: "Заступник міністра", id: "bogdan-drapiatyi" }
              ]
            },
            {
              name: "Міністерство закордонних справ",
              id: "mzs",
              description: "Займається зовнішньою політикою.",
              departments: [
                { name: "Управління закордонного українства", id: "mzs-ukrainians" },
                { name: "Управління цифровізації архіву", id: "mzs-digital" }
              ],
              enterprises: [],
              officials: [
                { name: "Олександр Баньков", position: "Державний секретар", id: "oleksandr-bankov" },
                { name: "Сергій Кислиця", position: "Перший заступник", id: "serhiy-kyslytsia" }
              ]
            }
          ]
        }
      ]
    };

    function showHome() {
      const content = document.getElementById('content');
      content.innerHTML = `
        <h1>Країни</h1>
        <ul class="list-group">
          ${data.countries.map(country => `
            <li class="list-group-item">
              <a href="#" onclick="showCountry('${country.id}')">${country.name}</a>
            </li>
          `).join('')}
        </ul>
        <p class="legal-notice">Відгуки є думками користувачів і не відображають позицію сайту.</p>
      `;
    }

    function showCountry(countryId) {
      const country = data.countries.find(c => c.id === countryId);
      const content = document.getElementById('content');
      content.innerHTML = `
        <h1>${country.name}</h1>
        <h2>Міністерства</h2>
        <div class="row">
          ${country.ministries.map(ministry => `
            <div class="col-md-6">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">
                    <a href="#" onclick="showMinistry('${country.id}', '${ministry.id}')">${ministry.name}</a>
                  </h5>
                  <p class="card-text">${ministry.description}</p>
                </div>
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    function showMinistry(countryId, ministryId) {
      const country = data.countries.find(c => c.id === countryId);
      const ministry = country.ministries.find(m => m.id === ministryId);
      const content = document.getElementById('content');
      content.innerHTML = `
        <h1>${ministry.name}</h1>
        <p>${ministry.description}</p>
        <h3>Підрозділи</h3>
        <ul class="list-group">
          ${ministry.departments.map(dep => `
            <li class="list-group-item">${dep.name}</li>
          `).join('')}
        </ul>
        <h3>Державні підприємства</h3>
        <ul class="list-group">
          ${ministry.enterprises.length > 0 ? ministry.enterprises.map(ent => `
            <li class="list-group-item">${ent.name}</li>
          `).join('') : '<li class="list-group-item">Немає</li>'}
        </ul>
        <h3>Чиновники</h3>
        <div class="row">
          ${ministry.officials.map(official => `
            <div class="col-md-6">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">
                    <a href="#" onclick="showOfficial('${country.id}', '${ministry.id}', '${official.id}')">${official.name}</a>
                  </h5>
                  <p class="card-text">${official.position}</p>
                </div>
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    function showOfficial(countryId, ministryId, officialId) {
      const country = data.countries.find(c => c.id === countryId);
      const ministry = country.ministries.find(m => m.id === ministryId);
      const official = ministry.officials.find(o => o.id === officialId);
      const content = document.getElementById('content');
      content.innerHTML = `
        <h1>${official.name}</h1>
        <p><strong>Посада:</strong> ${official.position}</p>
        <p><strong>Міністерство:</strong> ${ministry.name}</p>
        <h3>Відгуки</h3>
        <div class="comment-form">
          <input id="comment-author" class="form-control mb-2" placeholder="Ваше ім'я (необов’язково)">
          <textarea id="comment-text" class="form-control" rows="4" placeholder="Залиште ваш відгук"></textarea>
          <button onclick="addComment('${official.id}')" class="btn btn-primary mt-2">Надіслати</button>
        </div>
        <div id="comment-list" class="comment-list"></div>
      `;
      loadComments(officialId);
    }

    async function addComment(officialId) {
      console.log('Спроба додати коментар для officialId:', officialId);
      const author = document.getElementById('comment-author').value.trim() || 'Анонім';
      const text = document.getElementById('comment-text').value.trim();
      if (!text) {
        alert('Будь ласка, введіть відгук');
        return;
      }
      if (!db) {
        console.error('Firestore не ініціалізовано');
        alert('Помилка підключення до бази даних');
        return;
      }
      try {
        await db.collection('comments').add({
          officialId: officialId,
          author: author,
          text: text,
          date: new Date().toISOString()
        });
        console.log('Коментар додано успішно');
        document.getElementById('comment-author').value = '';
        document.getElementById('comment-text').value = '';
        loadComments(officialId);
      } catch (error) {
        console.error('Помилка при додаванні коментаря:', error);
        alert('Не вдалося додати коментар: ' + error.message);
      }
    }

    async function loadComments(officialId) {
      console.log('Завантаження коментарів для officialId:', officialId);
      const commentList = document.getElementById('comment-list');
      if (!db) {
        console.error('Firestore не ініціалізовано');
        commentList.innerHTML = '<p>Помилка підключення до бази даних</p>';
        return;
      }
      try {
        const snapshot = await db.collection('comments')
          .where('officialId', '==', officialId)
          .orderBy('date', 'desc')
          .get();
        const comments = snapshot.docs.map(doc => doc.data());
        console.log('Завантажено коментарів:', comments.length);
        commentList.innerHTML = comments.length > 0 ? comments.map(comment => `
          <div class="comment">
            <p><strong>${comment.author}</strong>: ${comment.text}</p>
            <small>${new Date(comment.date).toLocaleString('uk-UA')}</small>
          </div>
        `).join('') : '<p>Ще немає відгуків</p>';
      } catch (error) {
        console.error('Помилка при завантаженні коментарів:', error);
        commentList.innerHTML = '<p>Помилка при завантаженні відгуків: ' + error.message + '</p>';
      }
    }

    showHome();
  </script>
</body>
</html>